# Tuner

Tunerは、ユーザーが表示したアプリのテキストを継続的に記録・分析するためのmacOSアプリケーションです。

## 主な機能

- 継続的なテキスト記録
  - macOSのアクセシビリティ機能を利用
  - アクティブなアプリケーションのテキスト要素を自動取得・保存
  - JSONL形式での効率的なデータ管理

- データ品質の維持
  - 最小テキスト長、記号/数字のみのテキストを除外
  - 定期的な重複・類似テキストの検出と除去（MinHash利用）
  - バックグラウンドでの自動データ浄化

- テキスト分析と学習
  - N-gram言語モデルの構築と追加学習
  - アプリごとのテキスト量、言語割合などの統計情報表示
  - 自動学習スケジューリング（1日1回）

- データ連携
  - テキストファイルのインポート機能
  - 指定したアプリグループを介したデータ共有
  - アプリケーション除外機能

## データ保存プロセス

1. テキスト取得
   - アクセシビリティAPIまたはポーリングによる取得

2. 基本フィルタリング
   - 空文字列の除外
   - 最小長未満のテキスト除外
   - 記号/数字のみのテキスト除外

3. メモリ内バッファリング
   - 新規テキストエントリの一時保持

4. ファイル追記
   - 条件：メモリ内エントリ数が10件に達した場合
   - 条件：最後の保存から5秒経過した場合
   - 形式：JSONL形式でsavedTexts.jsonlに追記

## アプリケーション除外設定

- 実行中アプリの表示
  - アイコン付きで表示
  - 監視中/除外中の状態を色分け表示

- アプリ管理機能
  - テキスト検索による高速検索
  - 除外アプリの一覧表示
  - 一括リセット機能
  - 設定の自動保存

- デフォルト設定
  - FinderやTunerなど特定アプリは自動除外
  - バックグラウンドでのアプリアイコン取得

## データ浄化プロセス

### 実行タイミング
- 定期的実行：1時間ごと
- 高頻度実行：100件の新規エントリ追加時
- アプリケーション終了時

### 処理内容
1. savedTexts.jsonlファイルの読み込み
2. MinHashアルゴリズムによる類似テキスト検出
   - 類似度閾値：0.8
   - 3文字のキャラクターN-gram使用
   - 20個のハッシュ関数による類似度計算
3. 重複・類似エントリの除去
4. 一時ファイル生成と置換

## テキスト学習システム

### 増分学習（lmモデル）
- タイミング：500件の新規エントリ追加時
- 対象：直近の追記エントリ
- 目的：最新のテキスト傾向の反映
- 出力：lm_*.marisaファイル群

### 全体学習（originalモデル）
- タイミング：毎日午前0時
- 対象：全データ（最大100,000エントリ）
- 目的：ベースモデルの再構築
- 出力：original_*.marisaファイル

## テキストポーリング

- 設定可能なポーリング間隔
- アプリ別フィルタリング機能

## データ保存場所

- アプリグループコンテナ：group.dev.ensan.inputmethod.azooKeyMac
